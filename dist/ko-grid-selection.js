/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function u(p,q){return function(g){return g}(function(g,l,h){function r(k){var c=window.document.createElement("input");c.className="ko-grid-selection-element";c.type=k?"checkbox":"radio";c.tabIndex=-1;return c}h.defineExtension("ko-grid-selection",{r:function(k,c,b){function g(){t?(e={},f([])):b.data.source.streamValues(function(a){return a.filteredBy(b.data.predicate)}).then(function(a){return a.reduce(function(a,d){var c=b.data.valueSelector(d[m]);a.k.push(c);a.predicate[c]=!0;return a},{k:[],
predicate:{}})}).then(function(a){e=a.predicate;f(a.k)})}function h(a,c,d){a=b.data.observableValueSelector(l.unwrap(d[m]));n||(e={},f().length=0);e[a]?(delete e[a],f.remove(a)):(e[a]=!0,f.push(a))}var n=!(!k.allowMultiSelection&&!c.allowMultiSelection);c=!(!k.evaluateRowClicks&&!c.evaluateRowClicks);var t=!1,v=b.columns.add({key:"selection",label:"",width:b.layout.determineCellDimensions(r(n)).width+"px"}),w=b.headers.forColumn(v),e={},f=k.selectedEntriesIds||l.observableArray([]),m=b.primaryKey;
v.overrideValueBinding(function(){return{init:function(a){a.appendChild(r(n))},update:function(a,c,d){f();a.firstChild.checked=!!e[b.data.valueSelector(d[m])]}}});var p=w.element.subscribe(function(a){if(n&&a){var b=r(!0);a.appendChild(b);a.addEventListener("click",function(b){b.target===a&&(b.preventDefault(),g())})}});b.headers.onColumnHeaderClick(".ko-grid-selection-element",function(a){a.preventApplicationButAllowBrowserDefault();g()});if(c)b.data.onCellClick(h);else b.data.onCellClick(".ko-grid-selection-element",
h);b.data.rows.installClassifier(function(a){f();return e[b.data.observableValueSelector(l.unwrap(a[m]))]?["selected"]:[]});var q=l.computed(function(){var a=f().length,c=b.data.view.filteredSize();t=!!a&&a===c;var d=w.element();if(d=d&&d.querySelector(".ko-grid-selection-element"))d.checked=t,d.F=a>c});this.dispose=function(){p.dispose();q.dispose()}}});return h.declareExtensionAlias("selection","ko-grid-selection")}({},q,p))}
"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],u):window["ko-grid-selection"]=u(window.ko.bindingHandlers.grid,window.ko);